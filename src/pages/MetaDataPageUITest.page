<apex:page sidebar="false" controller="CSVReader" id="entirePage" docType="xhtml-1.0-strict">
    
    <link type="text/css" rel="stylesheet" href="{!URLFOR($Resource.Bootstrap,'bootstrap-3.3.6-dist/css/bootstrap.css')}" media="all"/>
    <!--apex:stylesheet value="{!$Resource.JqueryDataTableCSS}"/-->
    <apex:stylesheet value="{!URLFOR($Resource.DataTableNew,'DataTablesNew/media/css/jquery.dataTables.css')}"/>
    <apex:stylesheet value="{!$Resource.dataTablesFixedHeadersCSS}"/>
    <apex:includeScript value="{!$Resource.Jquery}"/>   
    <apex:includeScript value="{!$Resource.JqueryDataTableJS}"/>
    <apex:includeScript value="{!$Resource.dataTablesFixedColumnsMINJS}"/>
    <apex:includeScript value="{!$Resource.dataTablesFixedHeadersMINJS}"/>
    <apex:includeScript value="{!$Resource.JqueryFixedHeaderTableMIN}"/>
	<apex:includeScript value="{!$Resource.JqueryFixedHeaderTable}"/>
        <apex:includeScript value="{!$Resource.FloatThead}"/>
    
    <script>
    
    function alertUser() {
        if(confirm ('Changing the Field type will delete all the Existing data'))
        {
            changeStructure();
        }
        else
        {
            initialState();
        }
        
    }
    var $j = jQuery.noConflict();
    
    $j(document).ready(function() {
        var table = $j('#table1').DataTable({
        ordering: false,
        searching: false,
        fixedHeader: true,
        paging: false
        });
        
         $j("#contentWrapper").width("3040px");
        
        $j("#table1 tbody tr").each( function (i) {
            $j(this).hover(function() {
                var rowId = $j(this).attr("id");
                $j(this).attr( "title", 
                              $j(this).find('#'+rowId+'_objectName select option:selected').text()
                              +"."+ 
                              $j(this).find('#'+rowId+'_fieldName input').val());
            });
        });
         
        
        
    }); 
    
    </script>
    
    <style>  
        .red{ 
        color: red; background: pink; 
        }
        .commonChanges{
        
        }
        .headerText{
        text-align: center;
        font-weight: bold;
        }
        .inputTextBox{
        box-shadow: 1px 1px 1px #888888; 
        background-color: #FFFF99;
        }
        .columnWidthAuto{
        width: auto;
        }
        .inputTextArea{
        box-shadow: 1px 1px 1px #888888; 
        background-color: #FFFF99;
        border: 3px double #CCCCCC;
        font-family:tahoma, arial, sans-serif;
        }
        .columnWidthMinimum{
        width: 90px;
        }
        .checkboxStyle{
        display:inline-block; width:19px; height:19px; margin:-1px 4px 0 0; vertical-align:middle; cursor:pointer;
        }
        
    </style> 
    <apex:form id="frm1">
        
        <apex:commandButton action="{!DownloadSuccessExcel}" id="btnSuccess" value="Download Success File" rendered="{!showDownloadFilesButton}"/>
        <apex:commandButton action="{!DownloadErrorExcel}" id="btnError" value="Download Error File" rendered="{!showDownloadFilesButton}"/> 
        <apex:actionFunction action="{!changeStructure}" name="changeStructure"/>
        <apex:actionFunction action="{!initialState}" name="initialState"/>
        
        <div class="panel panel-group" style="box-shadow: 2px 2px 5px 5px #888888; background-color: #F4F0F0; margin-top:10px">
            <div  align="center" class="form-group">
                <apex:commandButton value="Apply Readonly to all profiles" action="{!applyReadonlyToAllProfiles}" reRender="mulPan" styleClass="btn-default" style="margin-top:10px; margin-right:10px; padding:8px 30px 6px;"/>
                <apex:commandButton value="Apply Visible to all profiles" action="{!applyVisibleToAllProfiles}" reRender="mulPan2" styleClass="btn-default" style="margin-top:10px;padding:8px 30px 6px;"/>
            </div>
            
            <div  align="center" class="form-group">
                <apex:commandButton action="{!validate}" value="Validate" style="margin-top:10px;padding:8px 30px 6px;" styleClass="btn-default submitAndValidateButtons" />
                <apex:commandButton action="{!validateAndSubmit}" value="Validate & Submit" style="margin-top:10px;padding:8px 30px 6px;" styleClass="btn-default submitAndValidateButtons"/>
                
                <apex:commandButton action="{!ignoreErrorsAndSubmit}" value="Ignore Errors & Submit" style="margin-top:10px;padding:8px 30px 6px;" styleClass="btn-default submitAndValidateButtons"/>
                <apex:commandButton action="{!callFLSPage}" value="Assign FLS" style="margin-top:10px;padding:8px 30px 6px;" styleClass="btn-default submitAndValidateButtons"/>

            </div>
        </div> 
        <apex:pagemessages />
        <apex:outputPanel id="datatable">
            <div style="margin:5px; width: 1520px; height: 100%; text-align:center; margin-botton:20px;">
                <table id="table1" class="table table-striped table-bordered" cellspacing="0" width="100%">
                    <thead>
                        <tr class="bg-primary" style="color:#000">
                            <th class="headerText"></th>
                            <th class="headerText">S.No.</th>
                            <th class="headerText">Object Name</th>
                            <th class="headerText">Data Type</th>
                            <th class="headerText">Label</th>
                            <th class="headerText">Field Name</th>
                            <th class="headerText">Length</th>
                            <th class="headerText">Decimal Places</th>
                            <th class="headerText">Visible Lines</th>
                            <th class="headerText">Picklist Values</th>
                            <th class="headerText">Picklist Sorted</th>
                            <th class="headerText">Default Value</th>
                            <th class="headerText">Required</th>
                            <th class="headerText">Track Feed History</th>
                            <th class="headerText">ExternalId</th>
                            <th class="headerText">Unique</th>
                            <th class="headerText">Related To Object</th>
                            <th class="headerText">Child Relationship Name</th>
                            <th class="headerText">Related List Label</th>
                            <th class="headerText">Description</th>
                            <th class="headerText">Help Text</th>                        
                        </tr>
                    </thead>
                    
                    <tbody>
                        
                        <apex:variable value="1" var="rowNum"/>
                        <apex:repeat value="{!dsList}" var="ds">
                            <tr id="row_{!rowNum}">
                                <td style="vertical-align: middle;"><apex:commandLink value="Del" action="{!onClickDelete}">
                                    <apex:param name="index" value="{!rowNum}"/>
                                    </apex:commandLink></td>
                                
                                <td style="vertical-align: middle;"><apex:outputtext value="{!rowNum}"/></td>
                                
                                <td style="vertical-align: middle;" id="row_{!rowNum}_objectName"><apex:selectList value="{!ds.objectName}" size="1">
                                    <apex:actionSupport event="onchange" action="{!changeStructure}" reRender="mulPan1"/>
                                    <apex:selectOptions value="{!allSobjects}"/>
                                    </apex:selectList></td>
                                
                                <td style="vertical-align: middle;"><apex:selectList value="{!ds.changedDataType}" onchange="alertUser()" size="1">
                                    <apex:selectOptions value="{!dataTypeOptions}"/>
                                    <apex:inputhidden id="fieldType" value="{!ds.fieldType}"></apex:inputhidden>
                                    </apex:selectList></td>
                                
                                <td style="vertical-align: middle;"><apex:inputText value="{!ds.fieldLabel}" styleClass="form-control inputTextBox columnWidthAuto" style="background-color:{!IF(ds.errorMap[6],'#FFE5E5','')}; border-style: solid;  border-left-color:#FF5555; border-left-width:5px;"/></td>
                                <td style="vertical-align: middle;" id="row_{!rowNum}_fieldName"><apex:inputText value="{!ds.fieldName}" styleClass="form-control inputTextBox columnWidthAuto" style="vertical-align:middle;background-color:{!IF(ds.errorMap[7],'#FFE5E5','')}; border-style: solid;  border-left-color:#FF5555; border-left-width:5px;"  /></td>
                                <td style="vertical-align: middle;"><apex:inputText disabled="{!ISNULL(ds.length)}" value="{!ds.length}" styleClass="form-control inputTextBox columnWidthMinimum" style="background-color:{!IF(ds.errorMap[8],'#FFE5E5','')}; border-style: {!IF (ds.length!=NULL,'solid;  border-left-color:#FF5555; border-left-width:5px','')};"/></td>
                                <td style="vertical-align: middle;"><apex:inputText value="{!ds.decimalPlace}" disabled="{!ISNULL(ds.decimalPlace)}" styleClass="form-control inputTextBox columnWidthMinimum" style="background-color:{!IF(ds.errorMap[9],'#FFE5E5','')};border-style: {!IF (ds.decimalPlace!=NULL,'solid;  border-left-color:#FF5555; border-left-width:5px','')};" /></td>
                                <td style="vertical-align: middle;"><apex:inputText value="{!ds.visibleLines}" disabled="{!ISNULL(ds.visibleLines)}" styleClass="form-control inputTextBox columnWidthMinimum" style="background-color:{!IF(ds.errorMap[10],'#FFE5E5','')}; border-style: {!IF (ds.visibleLines!=NULL,'solid;  border-left-color:#FF5555; border-left-width:5px','')};"/></td>
                                <td style="vertical-align: middle;"><apex:inputTextArea value="{!ds.picklistValue}" disabled="{!ISNULL(ds.picklistValue)}" styleClass="inputTextArea form-control" style="background-color:{!IF(ds.errorMap[11],'#FFE5E5','')}; border-style: {!IF (ds.picklistValue!=NULL,'solid;  border-left-color:#FF5555; border-left-width:5px','')};" /></td>
                                <td style="vertical-align: middle;"><apex:inputCheckbox value="{!ds.picklistSorted}" disabled="{!ISNULL(ds.picklistSortedCheck)}" styleClass="columnWidthMinimum checkboxStyle" style="background-color:{!IF(ds.errorMap[12],'#FFE5E5','')}"/></td>
                                <td style="vertical-align: middle;"><apex:inputText value="{!ds.fieldDefaultValue}" disabled="{!ISNULL(ds.fieldDefaultValue)}"  styleClass="form-control inputTextBox" style="background-color:{!IF(ds.errorMap[13],'#FFE5E5','')}"/></td>
                                <td style="vertical-align: middle;"><apex:inputCheckbox value="{!ds.required}" disabled="{!ISNULL(ds.requiredCheck)}" styleClass="columnWidthMinimum checkboxStyle" style="background-color:{!IF(ds.errorMap[14],'#FFE5E5','')}"/></td>
                                <td style="vertical-align: middle;"><apex:inputCheckbox value="{!ds.trackFeedHistory}" styleClass="columnWidthMinimum checkboxStyle" style="background-color:{!IF(ds.errorMap[15],'#FFE5E5','')}"/></td>
                                <td style="vertical-align: middle;"><apex:inputCheckbox value="{!ds.externalId}" disabled="{!ISNULL(ds.externalIdCheck)}" styleClass="columnWidthMinimum checkboxStyle" style="background-color:{!IF(ds.errorMap[16],'#FFE5E5','')}"/></td>
                                <td style="vertical-align: middle;"><apex:inputCheckbox value="{!ds.unique}" disabled="{!ISNULL(ds.uniqueCheck)}"  styleClass="columnWidthMinimum checkboxStyle" style="background-color:{!IF(ds.errorMap[17],'#FFE5E5','')}"/></td>
                                <td style="vertical-align: middle;"><apex:inputText value="{!ds.relatedToObject}" disabled="{!ISNULL(ds.lookupFieldCheck)}"  styleClass="form-control inputTextBox columnWidthAuto" style="background-color:{!IF(ds.errorMap[18],'#FFE5E5','')}; border-style: {!IF (ds.relatedToObject!=NULL,'solid;  border-left-color:#FF5555; border-left-width:5px','')};" /></td>
                                <td style="vertical-align: middle;"><apex:inputText value="{!ds.childRelationshipName}" disabled="{!ISNULL(ds.lookupFieldCheck)}"  styleClass="form-control inputTextBox columnWidthAuto" style="background-color:{!IF(ds.errorMap[19],'#FFE5E5','')}; border-style: {!IF (ds.childRelationshipName!=NULL,'solid;  border-left-color:#FF5555; border-left-width:5px','')};" /></td>
                                <td style="vertical-align: middle;"><apex:inputText value="{!ds.relatedListLabel}" disabled="{!ISNULL(ds.lookupFieldCheck)}"  styleClass="form-control inputTextBox columnWidthAuto" style="background-color:{!IF(ds.errorMap[20],'#FFE5E5','')}; border-style: {!IF (ds.relatedListLabel!=NULL,'solid;  border-left-color:#FF5555; border-left-width:5px','')};"/></td>
                                <td style="vertical-align: middle;"><apex:inputTextarea value="{!ds.Description}" styleClass="inputTextArea form-control columnWidthAuto" style="background-color:{!IF(ds.errorMap[21],'#FFE5E5','')}"/></td>
                                <td style="vertical-align: middle;"><apex:inputTextarea value="{!ds.helpText}" styleClass="inputTextArea form-control columnWidthAuto" style="background-color:{!IF(ds.errorMap[22],'#FFE5E5','')}"/></td>
                                
                            </tr>
                            <apex:variable var="rowNum" value="{!VALUE(rowNum) + 1}"/>
                        </apex:repeat>
                        
                    </tbody>
                </table>
                <div style="text-align:left;">
                   <apex:commandLink style="font-size:larger; background-image:url('{!URLFOR($Resource.images, 'images/add_row.gif')}'); background-repeat: no-repeat; background-size: contain; padding-left: 20px;" value="click here to Add new Row " action="{!addNewRowInTable}"/>
                </div>
            </div>
        </apex:outputPanel>
    </apex:form>   
</apex:page>